"use strict";(self["webpackChunkadminsys"]=self["webpackChunkadminsys"]||[]).push([[976],{3976:function(e,t,r){r.r(t),r.d(t,{default:function(){return d}});var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"roles-container"},[t("el-card",{staticClass:"box-card"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.addroleinfo.roleName,expression:"addroleinfo.roleName"}],attrs:{type:"text",placeholder:"角色名称"},domProps:{value:e.addroleinfo.roleName},on:{input:function(t){t.target.composing||e.$set(e.addroleinfo,"roleName",t.target.value)}}}),t("input",{directives:[{name:"model",rawName:"v-model",value:e.addroleinfo.roleDesc,expression:"addroleinfo.roleDesc"}],attrs:{type:"text",placeholder:"角色描述"},domProps:{value:e.addroleinfo.roleDesc},on:{input:function(t){t.target.composing||e.$set(e.addroleinfo,"roleDesc",t.target.value)}}}),t("el-button",{attrs:{type:"primary"},on:{click:e.addrole}},[e._v("添加角色")]),t("el-table",{attrs:{data:e.rolesList}},[t("el-table-column",{attrs:{type:"index",label:"#"}}),t("el-table-column",{attrs:{type:"expand",label:"展开"},scopedSlots:e._u([{key:"default",fn:function({row:r}){return e._l(r.children,(function(s,l){return t("el-row",{key:s.id,attrs:{gutter:20}},[t("div",{staticClass:"rolesitem"},[t("el-col",{attrs:{span:4}},[t("el-tag",{attrs:{closable:"",type:"info"}},[e._v(e._s(s.authName))])],1),t("el-col",{attrs:{span:20}},[t("hr"),e._l(s.children,(function(s,l){return t("el-row",{key:s.id,attrs:{gutter:20}},[t("el-col",{attrs:{span:5}},[t("el-tag",{key:s.id,attrs:{closable:"",type:"success"}},[e._v(e._s(s.authName))])],1),t("el-col",{attrs:{span:14}},e._l(s.children,(function(s,l){return t("el-tag",{key:s.id,attrs:{closable:"",type:"warning",plain:""},on:{close:function(t){return e.handleClose(s,r.id,r)}}},[e._v(e._s(s.authName))])})),1)],1)}))],2)],1)])}))}}])}),t("el-table-column",{attrs:{label:"ID",prop:"id"}}),t("el-table-column",{attrs:{label:"角色描述",prop:"roleDesc"}}),t("el-table-column",{attrs:{label:"角色名称",prop:"roleName"}}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function({row:r}){return[t("el-button",{attrs:{type:"primary",icon:"el-icon-edit"},on:{click:function(t){return e.edituser_row(r)}}}),t("el-button",{attrs:{type:"danger",icon:"el-icon-delete"},on:{click:function(t){return e.deluser_row(r)}}}),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"分配角色",placement:"right-start"}},[t("el-button",{attrs:{type:"success",icon:"el-icon-set-up"},on:{click:function(t){return e.assignment_roles(r)}}})],1)]}}])})],1)],1),t("el-dialog",{attrs:{title:"提示",visible:e.rightsVisible,width:"50%"},on:{"update:visible":function(t){e.rightsVisible=t}}},[t("el-tree",{ref:"rightsTree",attrs:{"node-key":"id","default-checked-keys":e.defKEY,"show-checkbox":"",data:e.rolesList_tree,props:e.defaultProps}}),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.rightsVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.seedroles}},[e._v("确 定")])],1)],1)],1)},l=[],i=(r(7658),r(7428)),o={components:{},name:"roles",props:[],data(){return{id:"",rightsVisible:!1,rolesList:[],rolesList_tree:[],defaultProps:{children:"children",label:"authName"},defKEY:[],addroleinfo:{}}},methods:{async deluser_row(e){try{await(0,i.k1)(e.id),this.getRolesList()}catch(t){console.log(t)}},async addrole(){try{await(0,i.Xp)(this.addroleinfo),this.getRolesList()}catch(e){}},async seedroles(){let e=[...this.$refs.rightsTree.getCheckedKeys(),...this.$refs.rightsTree.getHalfCheckedKeys()].join(",");try{await(0,i.dm)(this.id,e),this.getRolesList()}catch(t){}this.rightsVisible=!1},assignment_roles(e){this.id=e.id,this.defKEY=[],this.find3id(e,this.defKEY),this.$nextTick((()=>{this.$refs.rightsTree.setCheckedKeys(this.defKEY)})),this.rightsVisible=!this.rightsVisible},find3id(e,t){if(!e.children)return t.push(e.id);e.children.forEach((e=>{this.find3id(e,t)}))},async handleClose(e,t,r){try{let{id:s}=e,l=await(0,i.wu)(t,s);r.children=l}catch(s){console.log(s)}},async getRolesList(){try{this.rolesList=await(0,i.IG)()}catch(e){}},async getRolesList_tree(){try{this.rolesList_tree=await(0,i.Py)("tree")}catch(e){}}},computed:{},watch:{},created(){this.getRolesList(),this.getRolesList_tree()},mounted(){}},n=o,a=r(1001),c=(0,a.Z)(n,s,l,!1,null,null,null),d=c.exports},7428:function(e,t,r){r.d(t,{IG:function(){return i},Py:function(){return l},Xp:function(){return a},dm:function(){return n},k1:function(){return c},wu:function(){return o}});var s=r(8365);function l(e="list"){return(0,s.Z)({method:"GET",url:`/rights/${e}`})}function i(e){return(0,s.Z)({method:"GET",url:"/roles"})}function o(e,t){return(0,s.Z)({method:"delete",url:`/roles/${e}/rights/${t}`})}function n(e,t){return(0,s.Z)({method:"POST",url:`/roles/${e}/rights`,data:{rids:t}})}function a(e){return(0,s.Z)({method:"post",url:"/roles",data:e})}function c(e){return(0,s.Z)({method:"delete",url:`roles/${e}`})}}}]);
//# sourceMappingURL=976.aa4c3b45.js.map