(self["webpackChunkadminsys"]=self["webpackChunkadminsys"]||[]).push([[982],{982:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return m}});var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"user-container"},[t("el-card",{staticClass:"box-card"},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:10}},[t("el-input",{attrs:{placeholder:"请输入内容"},model:{value:e.input,callback:function(t){e.input=t},expression:"input"}})],1),t("el-col",{attrs:{span:10}},[t("el-button",{attrs:{type:"primary"},on:{click:e.search}},[e._v("搜索")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogadduser=!e.dialogadduser}}},[e._v("添加")])],1)],1)],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.usersList,border:""}},[t("el-table-column",{attrs:{type:"index",width:"auto",label:"#"}}),t("el-table-column",{attrs:{prop:"id",label:"id",width:"120"}}),t("el-table-column",{attrs:{prop:"role_name",label:"role_name",width:"120"}}),t("el-table-column",{attrs:{prop:"username",label:"username",width:"120"}}),t("el-table-column",{attrs:{prop:"create_time",label:"create_time",width:"120"}}),t("el-table-column",{attrs:{prop:"mobile",label:"mobile",width:"120"}}),t("el-table-column",{attrs:{prop:"email",label:"email",width:"180"}}),t("el-table-column",{attrs:{label:"mg_state",width:"120"},scopedSlots:e._u([{key:"default",fn:function({row:r}){return[t("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},on:{change:function(t){return e.change(r,t)}},model:{value:r.mg_state,callback:function(t){e.$set(r,"mg_state",t)},expression:"row.mg_state"}})]}}])}),t("el-table-column",{attrs:{label:"操作",width:"auto"},scopedSlots:e._u([{key:"default",fn:function({row:r}){return[t("el-button",{attrs:{type:"primary",icon:"el-icon-edit"},on:{click:function(t){return e.getuser_row(r)}}}),t("el-button",{attrs:{type:"danger",icon:"el-icon-delete"},on:{click:function(t){return e.deluser_row(r)}}}),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"分配角色",placement:"right-start"}},[t("el-button",{attrs:{type:"success",icon:"el-icon-set-up"},on:{click:function(t){return e.assignmentrole(r)}}})],1)]}}])})],1),t("br"),t("br"),t("el-pagination",{attrs:{"page-sizes":[1,2,3,5],"current-page":e.Listconfig.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),t("el-dialog",{attrs:{title:"添加用户","append-to-body":"",visible:e.dialogadduser},on:{"update:visible":function(t){e.dialogadduser=t}}},[t("el-form",{ref:"adduserfromRef",attrs:{model:e.adduserform,rules:e.adduserrules}},[t("el-form-item",{attrs:{label:"用户名称",prop:"username"}},[t("el-input",{model:{value:e.adduserform.username,callback:function(t){e.$set(e.adduserform,"username",t)},expression:"adduserform.username"}})],1),t("el-form-item",{attrs:{label:"用户密码",prop:"password"}},[t("el-input",{model:{value:e.adduserform.password,callback:function(t){e.$set(e.adduserform,"password",t)},expression:"adduserform.password"}})],1),t("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[t("el-input",{model:{value:e.adduserform.email,callback:function(t){e.$set(e.adduserform,"email",t)},expression:"adduserform.email"}})],1),t("el-form-item",{attrs:{label:"手机号",prop:"mobile"}},[t("el-input",{model:{value:e.adduserform.mobile,callback:function(t){e.$set(e.adduserform,"mobile",t)},expression:"adduserform.mobile"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogadduser=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.adduser}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"编辑用户","append-to-body":"",visible:e.dialogedituser},on:{"update:visible":function(t){e.dialogedituser=t}}},[t("el-form",{ref:"edit_row_userfromRef",attrs:{model:e.selectuserinfo,rules:e.adduserrules}},[t("el-form-item",{attrs:{label:"用户名"}},[t("el-input",{attrs:{disabled:""},model:{value:e.selectuserinfo.username,callback:function(t){e.$set(e.selectuserinfo,"username",t)},expression:"selectuserinfo.username"}})],1),t("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[t("el-input",{model:{value:e.selectuserinfo.email,callback:function(t){e.$set(e.selectuserinfo,"email",t)},expression:"selectuserinfo.email"}})],1),t("el-form-item",{attrs:{label:"手机号",prop:"mobile"}},[t("el-input",{model:{value:e.selectuserinfo.mobile,callback:function(t){e.$set(e.selectuserinfo,"mobile",t)},expression:"selectuserinfo.mobile"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogedituser=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.edituser_row}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"提示",visible:e.roleVisible},on:{"update:visible":function(t){e.roleVisible=t}}},[e._v(" 用户当前ID: "+e._s(e.roleinfo.id)),t("br"),e._v(" 用户当前角色: "+e._s(e.roleinfo.role_name)),t("br"),t("br"),t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},e._l(e.roleList,(function(e){return t("el-option",{key:e.id,attrs:{label:e.roleName,value:e.id}})})),1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.roleVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.addrole}},[e._v("确 定")])],1)],1)],1)},s=[],n=r(8500),a=r.n(n),i=r(2900),l=r(7428),u={components:{},name:"user",props:[],data(){const e=(e,t,r)=>{try{if(!t)return r(new Error("邮箱格式不能为空"));let e=a().z_regex.validate({email:t}).email;if(!e)return r(new Error("邮箱格式不正确"));if(e)return r()}catch(o){return r(new Error(o))}},t=(e,t,r)=>{try{if(!t)return r(new Error("手机号不能为空"));let e=a().z_regex.validate({phone:t}).phone;if(!e)return r(new Error("手机号格式不正确"));if(e)return r()}catch(o){return r(new Error(o))}};return{roleVisible:!1,adduserform:{},adduserrules:{username:[{required:!0,message:"用户名称不能为空",trigger:"blur"}],password:[{required:!0,message:"用户密码不能为空",trigger:"blur"}],email:[{required:!0,validator:e,trigger:"blur"}],mobile:[{required:!0,validator:t,trigger:"blur"}]},Listconfig:{query:"",pagenum:1,pagesize:1},total:0,input:"",usersList:[],dialogadduser:!1,dialogedituser:!1,selectuserinfo:{email:"",mobile:"",username:""},roleList:[],roleinfo:{},value:""}},methods:{async assignmentrole(e){try{this.roleList=await(0,l.IG)(),this.roleinfo=e,this.roleVisible=!this.roleVisible,this.value=""}catch(t){console.log(t)}},async addrole(){try{if(!this.value)return this.$message("请选择用户角色");await(0,i.rN)(this.roleinfo.id,this.value);this.getusersList(),this.roleVisible=!this.roleVisible}catch(e){}},async deluser_row(e){try{await(0,i.rZ)(e.id);let t=await(0,i.$V)(e.id);console.log(t),this.getusersList()}catch(t){console.log(t)}},async edituser_row(){try{await new Promise(((e,t)=>{this.$refs.edit_row_userfromRef.validate((r=>{r&&e(r),t(r)}))}));await(0,i.nk)(this.selectuserinfo);this.getusersList(),this.dialogedituser=!this.dialogedituser}catch(e){console.log(e)}},async getuser_row(e){this.dialogedituser=!this.dialogedituser;try{let t=await(0,i.$V)(e.id);this.selectuserinfo=t}catch(t){console.log(t)}},async adduser(){try{await new Promise(((e,t)=>{this.$refs.adduserfromRef.validate((r=>{r&&e(r),t(r)}))}));await(0,i.H8)(this.adduserform);this.dialogadduser=!this.dialogadduser,this.adduserform={},this.getusersList()}catch(e){console.log(e)}},search(){this.Listconfig.query=this.input,this.getusersList()},handleSizeChange(e){this.Listconfig.pagesize=e,this.getusersList()},handleCurrentChange(e){this.Listconfig.pagenum=e,this.getusersList()},async change(e,t){try{await(0,i.eM)(e.id,t)}catch(r){console.log(r)}},async getusersList(){try{let e=await(0,i.qS)(this.Listconfig);this.total=e.total,this.usersList=e.users}catch(e){console.log(e)}}},computed:{},watch:{},created(){this.getusersList()},mounted(){}},c=u,d=r(1001),f=(0,d.Z)(c,o,s,!1,null,null,null),m=f.exports},7428:function(e,t,r){"use strict";r.d(t,{IG:function(){return n},Py:function(){return s},Xp:function(){return l},dm:function(){return i},k1:function(){return u},wu:function(){return a}});var o=r(8365);function s(e="list"){return(0,o.Z)({method:"GET",url:`/rights/${e}`})}function n(e){return(0,o.Z)({method:"GET",url:"/roles"})}function a(e,t){return(0,o.Z)({method:"delete",url:`/roles/${e}/rights/${t}`})}function i(e,t){return(0,o.Z)({method:"POST",url:`/roles/${e}/rights`,data:{rids:t}})}function l(e){return(0,o.Z)({method:"post",url:"/roles",data:e})}function u(e){return(0,o.Z)({method:"delete",url:`roles/${e}`})}},2900:function(e,t,r){"use strict";r.d(t,{$V:function(){return u},H8:function(){return l},UO:function(){return s},Yg:function(){return n},eM:function(){return i},nk:function(){return c},qS:function(){return a},rN:function(){return f},rZ:function(){return d}});var o=r(8365);function s(e){return(0,o.Z)({method:"POST",url:"/login",data:e})}function n(){return(0,o.Z)({method:"GET",url:"/menus"})}function a(e){return(0,o.Z)({method:"get",url:"/users",params:e})}function i(e,t){return(0,o.Z)({method:"PUT",url:`users/${e}/state/${t}`})}function l(e){return(0,o.Z)({method:"post",url:"/users",data:e})}function u(e){return(0,o.Z)({method:"get",url:`users/${e}`})}function c(e){return(0,o.Z)({method:"PUT",url:`users/${e.id}`,data:e})}function d(e){return(0,o.Z)({method:"delete",url:`users/${e}`})}function f(e,t){return(0,o.Z)({method:"PUT",url:`users/${e}/role`,data:{rid:t}})}},8500:function(e){class t{constructor(){}static z_request={jsonptojson(e){const t=/^(\w+)\((.*)\)$/,r=e.match(t);if(!r)return console.error("无效的 JSONP 格式"),null;{const[,e,t]=r;try{const r=JSON.parse(t);return{callbackName:e,jsonObj:r}}catch(o){return console.error("JSON 解析错误",o),null}}}};static z_url={parseUrl(e){const t=e.split("?"),r=t[0],o=2===t.length?t[1]:"",s={};if(o){const e=o.split("&");for(let t=0;t<e.length;t++){const[r,o]=e[t].split("=");s[r]=decodeURIComponent(o)}}const n=e.match(/^(?:https?:\/\/)?([^\/]+)/i),a=n?n[1]:"";return{pathname:r,search:o,host:a,params:s}}};static z_time={formatTimestamp(e){const t=new Date(e),s=new Date,n=s-t,a=n/1e3,i=a/60,l=i/60,u=l/24;return{published:o(a,i,l,u),year:t.getFullYear(),month:r(t.getMonth()+1),day:r(t.getDate()),hours:r(t.getHours()),minutes:r(t.getMinutes()),seconds:r(t.getSeconds()),iso8601:t.toISOString(),localeString:t.toLocaleString(),localeDateString:t.toLocaleDateString(),localeTimeString:t.toLocaleTimeString()}}};static z_js={getType(e){const t=Object.prototype.toString.call(e),r={"[object String]":"string","[object Number]":"number","[object Boolean]":"boolean","[object Undefined]":"undefined","[object Null]":"null","[object Array]":"array","[object Object]":"object","[object Date]":"date","[object RegExp]":"regexp","[object Error]":"error","[object Function]":"function"};return r[t]||"unknown"}};static z_str={truncateString(e,t){if("string"!==typeof e||"number"!==typeof t)throw new TypeError("truncateString(): 参数必须是字符串和数字类型");if(e.length<=t)return e;if(t<3)throw new Error("truncateString(): 最大长度必须至少为 3");return e.substr(0,t-3)+"..."},replaceAll(e,t,r){if("string"!==typeof e||"string"!==typeof t||"string"!==typeof r)throw new TypeError("replaceAll(): 参数必须都是字符串类型");if(""===t)throw new Error("replaceAll(): 查找字符串不能为空");const o=new RegExp(t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g");return e.replace(o,r)},getAllTextBetween(e,t,r){const o=new RegExp(`${t}(.*?)${r}`,"gs"),s=e.match(o);return s?s.map((e=>e.slice(t.length,-r.length))):[]}};static z_html={getTagAttrValues(e,t,r=undefined,o=undefined){const s=new RegExp(`<${t}[^>]*?(?:\\s${r}(?:=(?:"([^"]*)"|'([^']*)'|([^\\s>]+)))?)[^>]*>`,"gi"),n=e.match(s);if(!n)return r?[]:{};if(!r){const e={};return n.forEach((t=>{const r=t.match(/(?:\s+(\S+)(?:(?:=(?:"([^"]*)"|'([^']*)'|([^\\s>]+)))?)?)+/g),o={};r.forEach((e=>{const[t,r,s,n,a]=e.match(/(\S+)(?:(?:=(?:"([^"]*)"|'([^']*)'|([^"'\s>]+)))?)?/);o[r]=s||n||a||""}));const s=o.id||o.name||o.class;s&&(e[s]=o)})),e}const a=n.map((e=>{const[,t,o,s]=e.match(new RegExp(`\\s${r}(?:=(?:"([^"]*)"|'([^']*)'|([^\\s>]+)))?`));return t||o||s||""})).filter((e=>""!==e));return o?a.slice(0,o):a}};static z_regex={validate(e){if("object"!==typeof e||Array.isArray(e))throw new TypeError("参数必须为对象类型");const t=[{regex:/^[1-9]\d{5}(18|19|20)\d{2}((0[1-9])|(1[0-2]))(([0-2][1-9])|(30|31))\d{3}[0-9Xx]$/,propName:"idCard"},{regex:/^(13[0-9]|14[5-9]|15[0-3,5-9]|16[2567]|17[0-8]|18[0-9]|19[89])\d{8}$/,propName:"phone"},{regex:/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(\.[a-zA-Z0-9_-]+)+$/,propName:"email"},{regex:/^\d{16,19}$/,propName:"bankCard"},{regex:/^[\u4e00-\u9fa5]{1}[A-Z]{1}[A-Z_0-9]{5}$/,propName:"carNumber"}];try{return Object.entries(e).reduce(((e,[r,o])=>{const s=t.find((e=>e.propName===r));return s&&(e[s.propName]=s.regex.test(o)),e}),{})}catch(r){throw new Error(`验证过程中发生了异常：${r.message}`)}}}}function r(e){return e<10?"0"+e:e}function o(e,t,r,o){return o>=1?Math.floor(o)+"天前":r>=1?Math.floor(r)+"小时前":t>=1?Math.floor(t)+"分钟前":Math.floor(e)+"秒前"}e.exports=t}}]);
//# sourceMappingURL=982.3059a789.js.map